<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mini Golf - Minimal</title>
    <style>
      body {
        margin: 0;
        padding: 20px;
        background: #fff1d4;
        font-family: Arial, sans-serif;
        text-align: center;
      }

      .container {
        max-width: 800px;
        margin: 0 auto;
        padding: 40px 20px;
        background: #fff1d4;
        border-radius: 16px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      }

      h1 {
        color: #02210a;
        margin-bottom: 10px;
      }
      p {
        color: #420d00;
        margin-bottom: 20px;
      }

      .email-form {
        display: flex;
        gap: 10px;
        justify-content: center;
        margin-bottom: 30px;
        flex-wrap: wrap;
      }

      input[type="email"] {
        padding: 12px 16px;
        font-size: 16px;
        border: 1px solid #ccc;
        border-radius: 6px;
        min-width: 250px;
      }

      button {
        padding: 12px 20px;
        font-size: 16px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-weight: 600;
      }

      .email-btn {
        background: #923c07;
        color: white;
      }

      .game-btn {
        background: #02210a;
        color: #fff1d4;
        margin: 10px 5px;
      }

      .putt-btn {
        background: #ec3c28;
        color: white;
        animation: pulse 1s infinite;
      }

      @keyframes pulse {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.7;
        }
      }

      #game {
        display: none;
        margin-top: 20px;
      }

      .game-area {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 20px;
        margin: 20px 0;
      }

      .canvas-container {
        position: relative;
        text-align: center;
      }

      canvas {
        border: 2px solid #02210a;
        border-radius: 12px;
        max-width: 100%;
        display: block;
      }

      .putty-character {
        position: absolute;
        left: 15px;
        top: 2px;
        height: 90px;
        pointer-events: none;
      }

      .game-info {
        max-width: 200px;
        text-align: left;
      }

      .stats {
        margin: 10px 0;
        font-weight: bold;
        color: #02210a;
        text-align: center;
      }

      .status {
        margin: 15px 0;
        padding: 12px 24px;
        border-radius: 8px;
        font-weight: 600;
        text-align: center;
      }

      .instructions {
        background: rgba(2, 33, 10, 0.05);
        padding: 15px;
        border-radius: 8px;
        margin: 10px 0;
        font-size: 14px;
        line-height: 1.4;
        color: #420d00;
      }

      .instructions h3 {
        margin: 0 0 10px 0;
        color: #02210a;
        font-size: 16px;
      }

      .power-display {
        text-align: center;
        margin: 10px 0;
        font-weight: bold;
        color: #02210a;
        font-size: 18px;
      }

      .status.ready {
        background: rgba(2, 33, 10, 0.1);
        color: #02210a;
      }
      .status.aiming {
        background: rgba(236, 60, 40, 0.1);
        color: #ec3c28;
      }
      .status.shooting {
        background: rgba(76, 175, 80, 0.1);
        color: #4caf50;
      }

      .prize {
        display: none;
        background: linear-gradient(135deg, #4caf50, #45a049);
        color: white;
        padding: 30px;
        border-radius: 16px;
        margin: 20px 0;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        width: 100%;
        gap: 10px;
      }

      .lose {
        display: none;
        background: linear-gradient(135deg, #f44336, #d32f2f);
        color: white;
        padding: 30px;
        border-radius: 16px;
        margin: 20px 0;
      }

      .code {
        background: rgba(255, 255, 255, 0.2);
        padding: 8px 16px;
        border-radius: 6px;
        font-family: monospace;
        font-size: 1.2em;
        font-weight: bold;
        letter-spacing: 2px;
        margin: 10px;
        border: 2px dashed rgba(255, 255, 255, 0.5);
      }

      /* Responsive design */
      @media (max-width: 768px) {
        .game-area {
          flex-direction: column;
          align-items: center;
        }

        .game-info {
          max-width: 100%;
          text-align: center;
        }

        .instructions {
          text-align: left;
          max-width: 350px;
        }

        .putty-character {
          height: 60px;
          left: 10px;
          top: 2px;
        }

        canvas {
          max-width: 90vw;
        }
      }

      @media (max-width: 480px) {
        .container {
          padding: 20px 10px;
        }

        .email-form {
          flex-direction: column;
          align-items: center;
        }

        input[type="email"] {
          min-width: 200px;
          margin-bottom: 10px;
        }

        .putty-character {
          height: 45px;
          left: 8px;
          top: 0px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>GAME_TITLE</h1>
      <p>GAME_SUBTITLE</p>

      <!-- Email Form -->
      <div id="emailSection">
        <!-- Email Signup Form for Mini Golf -->
        <form
          id="email-form"
          style="margin-top: 30px; display: flex; justify-content: center; gap: 10px; flex-wrap: wrap"
          onsubmit="window.GolfGameHandleFormSubmit(event)"
        >
          <input
            type="email"
            name="email"
            id="email"
            required
            placeholder="EMAIL_PLACEHOLDER"
            style="
              padding: 12px 16px;
              font-size: 16px;
              border: 1px solid #ccc;
              border-radius: 6px;
              min-width: 280px;
              font-family: 'General Sans', sans-serif;
            "
          />
          <button
            type="submit"
            style="
              background-color: #923c07;
              color: white;
              padding: 12px 20px;
              font-size: 16px;
              border: none;
              border-radius: 6px;
              cursor: pointer;
              font-family: 'General Sans', sans-serif;
            "
          >
            SUBMIT_BUTTON_TEXT
          </button>
        </form>
      </div>

      <!-- Game -->
      <div id="game">
        <div id="status" class="status aiming">Watch the power meter and click PUTT to shoot!</div>
        <div class="game-area">
          <div class="canvas-container">
            <canvas id="canvas" width="700" height="120"></canvas>
            <!-- <img src="putty.png" alt="Putty" class="putty-character" /> -->
          </div>

          <div class="game-info">
            <!-- <div class="instructions">
              <h3>How to Play</h3>
              <p>üéØ Watch the power meter bounce</p>
              <p>‚è±Ô∏è Click PUTT at the right moment</p>
              <p>üèåÔ∏è Reach exactly 10 units to win!</p>
              <p>‚ö†Ô∏è Don't overshoot or you lose</p>
            </div> -->

            <div class="stats">
              <div><span id="shots">Shots: 0</span></div>
              <div><span id="distance">Distance to go: 10</span></div>
            </div>
          </div>
        </div>
        <button id="puttBtn" class="game-btn putt-btn" onclick="GolfGamePutt()" style="display: none">üèåÔ∏è PUTT!</button>
      </div>

      <!-- Prize -->
      <div id="prize" class="prize">
        <h2 id="prizeTitle">üéâ You Won!</h2>
        <p id="prizeDesc">Amazing prize!</p>
        <div>Your Code: <span id="prizeCode" class="code">CODE123</span></div>
        <button
          class="game-btn"
          onclick="GolfGameReset()"
          style="background: rgba(255, 255, 255, 0.2); border: 2px solid white"
        >
          Play Again
        </button>
      </div>

      <!-- Lose -->
      <div id="lose" class="lose">
        <h2>Oops! You overshot!</h2>
        <p>Don't worry, try again!</p>
        <button
          class="game-btn"
          onclick="GolfGameReset()"
          style="background: rgba(255, 255, 255, 0.2); border: 2px solid white"
        >
          üîÑ Try Again
        </button>
      </div>
    </div>

    <script>
      const GAME_TITLE = "GAME_TITLE";
      const GAME_SUBTITLE = "GAME_SUBTITLE";
      const EMAIL_PLACEHOLDER = "EMAIL_PLACEHOLDER";
      const SUBMIT_BUTTON_TEXT = "SUBMIT_BUTTON_TEXT";
      const AIM_BANNER_TEXT = "Click PUTT to shoot at the displayed power level!";
      const MARKETING_URL = "https://manage.kmail-lists.com/subscriptions/subscribe?a=Sg8ErC&g=VR7JgL";
      const PUTTY_IMAGE_URL = "putty.png";
      const PRIZE_1_NAME = "PRIZE_1_NAME";
      const PRIZE_1_CODE = "PRIZE_1_CODE";
      const PRIZE_1_DESC = "PRIZE_1_DESC";
      const PRIZE_2_NAME = "PRIZE_2_NAME";
      const PRIZE_2_CODE = "PRIZE_2_CODE";
      const PRIZE_2_DESC = "PRIZE_2_DESC";
      const PRIZE_3_NAME = "PRIZE_3_NAME";
      const PRIZE_3_CODE = "PRIZE_3_CODE";
      const PRIZE_3_DESC = "PRIZE_3_DESC";
      const PRIZE_4_NAME = "PRIZE_4_NAME";
      const PRIZE_4_CODE = "PRIZE_4_CODE";
      const PRIZE_4_DESC = "PRIZE_4_DESC";
      const PRIZE_5_NAME = "PRIZE_5_NAME";
      const PRIZE_5_CODE = "PRIZE_5_CODE";
      const PRIZE_5_DESC = "PRIZE_5_DESC";

      const PUTTY_X_OFFSET = 25;
      const PUTTY_Y_OFFSET = -5;

      const TICK_SPEED = 2;

      // Game state
      let shots = 0,
        distance = 0,
        target = 10;
      let powerTick = 0,
        tickDir = 1,
        power = 1;
      let animId = null,
        ballAnimId = null;
      let ballStart = 0,
        ballTarget = 0,
        ballAnimStart = 0;
      let state = "email"; // email, ready, aiming, shooting, won, lost

      // Canvas and context
      const canvas = document.getElementById("canvas");
      const ctx = canvas.getContext("2d");

      // Putty image
      const puttyImg = new Image();
      puttyImg.src = PUTTY_IMAGE_URL;
      let puttyLoaded = false;
      puttyImg.onload = () => {
        puttyLoaded = true;
        draw();
      };

      // Canvas button hit area
      let puttBtnRect = { x: 0, y: 0, w: 0, h: 0 };

      canvas.addEventListener("click", (e) => {
        if (state !== "aiming") return;
        const rect = canvas.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        if (
          x >= puttBtnRect.x &&
          x <= puttBtnRect.x + puttBtnRect.w &&
          y >= puttBtnRect.y &&
          y <= puttBtnRect.y + puttBtnRect.h
        ) {
          GolfGamePutt();
        }
      });

      // Add cursor pointer when hovering over putt button
      canvas.addEventListener("mousemove", (e) => {
        if (state !== "aiming") {
          canvas.style.cursor = "default";
          return;
        }
        const rect = canvas.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        if (
          x >= puttBtnRect.x &&
          x <= puttBtnRect.x + puttBtnRect.w &&
          y >= puttBtnRect.y &&
          y <= puttBtnRect.y + puttBtnRect.h
        ) {
          canvas.style.cursor = "pointer";
        } else {
          canvas.style.cursor = "default";
        }
      });

      // Prize data
      const prizes = [
        { name: PRIZE_1_NAME, code: PRIZE_1_CODE, desc: PRIZE_1_DESC },
        { name: PRIZE_2_NAME, code: PRIZE_2_CODE, desc: PRIZE_2_DESC },
        { name: PRIZE_3_NAME, code: PRIZE_3_CODE, desc: PRIZE_3_DESC },
        { name: PRIZE_4_NAME, code: PRIZE_4_CODE, desc: PRIZE_4_DESC },
        { name: PRIZE_5_NAME, code: PRIZE_5_CODE, desc: PRIZE_5_DESC },
      ];

      // Handle form submission with preventDefault
      window.GolfGameHandleFormSubmit = function (event) {
        event.preventDefault();
        event.stopPropagation();

        const form = event.target;
        const formData = new FormData(form);
        const email = formData.get("email");

        if (!email || !email.includes("@")) {
          alert("Please enter a valid email address");
          return;
        }

        if (MARKETING_URL) {
          fetch(MARKETING_URL, {
            method: "POST",
            body: formData,
            mode: "no-cors",
          }).catch((error) => console.log("Email service error:", error));
        }

        // Start the game immediately
        GolfGameStartGame();
      };

      // Start game after email (called by form submission)
      window.GolfGameStartGame = function () {
        showEmail(false);
        showGame(true);
        showAimBanner(true);

        // Auto-start aiming instead of requiring button click
        state = "aiming";
        startAiming();
        draw();
      };

      // Take shot
      window.GolfGamePutt = function () {
        if (state !== "aiming") return;

        cancelAnimationFrame(animId);
        animId = null;
        state = "shooting";
        shots++;

        ballStart = distance;
        ballTarget = distance + power;
        ballAnimStart = performance.now();
        distance += power;

        document.getElementById("status").textContent = `Shot ${power} units! Ball at distance ${distance}`;
        document.getElementById("status").className = "status shooting";
        updateStats();

        // Animate ball
        function animateBall() {
          const elapsed = performance.now() - ballAnimStart;
          const progress = Math.min(elapsed / 1000, 1);

          draw();

          if (progress < 1) {
            ballAnimId = requestAnimationFrame(animateBall);
          } else {
            checkEnd();
          }
        }
        animateBall();
      };

      // Reset game
      window.GolfGameReset = function () {
        shots = 0;
        distance = 0;
        power = 1;
        powerTick = 0;
        tickDir = 1;
        ballStart = 0;
        ballTarget = 0;
        ballAnimStart = 0;
        state = "email";

        if (animId) cancelAnimationFrame(animId);
        if (ballAnimId) cancelAnimationFrame(ballAnimId);
        animId = null;
        ballAnimId = null;

        showPrizeBanner(false);
        showLoseBanner(false);
        GolfGameStartGame();
        updateStats();
      };

      // Start aiming phase
      function startAiming() {
        // Ensure only one aim animation loop is running
        if (animId) {
          cancelAnimationFrame(animId);
          animId = null;
        }
        // Start power meter animation
        function animate() {
          if (state !== "aiming" && state !== "email") return;

          powerTick += TICK_SPEED * tickDir;
          if (powerTick <= 0) {
            powerTick = 0;
            tickDir = 1;
          }
          // meter width is 160, use that as max
          if (powerTick >= 160) {
            powerTick = 160;
            tickDir = -1;
          }

          power = Math.round(1 + (powerTick / 160) * 9);
          draw();
          animId = requestAnimationFrame(animate);
        }
        animate();
      }

      // Check win/lose
      function checkEnd() {
        if (distance === target) {
          // Win!
          state = "won";
          const prize = prizes[shots] || prizes[4];
          showPrizeBanner(true, prize);
        } else if (distance > target) {
          // Lose!
          state = "lost";
          showLoseBanner(true);
        } else {
          // Continue - auto-start aiming again
          state = "aiming";
          showAimBanner(true);
          startAiming();
        }
      }

      // Update stats display
      function updateStats() {
        document.getElementById("shots").textContent = `Shots: ${shots}`;
        document.getElementById("distance").textContent = `Distance to go: ${target - distance}`;
      }

      function showEmail(show = true) {
        document.getElementById("emailSection").style.display = show ? "block" : "none";
      }

      function showGame(show = true) {
        document.getElementById("game").style.display = show ? "block" : "none";
      }

      function showStatusBanner(show = true, text, state) {
        document.getElementById("status").style.display = show ? "block" : "none";
        if (show) {
          document.getElementById("status").textContent = text;
          document.getElementById("status").className = `status ${state}`;
        }
      }

      function showAimBanner(show = true) {
        showStatusBanner(show, AIM_BANNER_TEXT, "aiming");
      }

      function showPrizeBanner(show = true, prize = null) {
        document.getElementById("prize").style.display = show ? "flex" : "none";
        if (prize) {
          document.getElementById("prizeTitle").textContent = `üéâ ${prize.name}`;
          document.getElementById("prizeDesc").textContent = prize.desc;
          document.getElementById("prizeCode").textContent = prize.code;
        }
      }

      function showLoseBanner(show = true) {
        document.getElementById("lose").style.display = show ? "block" : "none";
      }

      // Draw game
      function draw() {
        ctx.clearRect(0, 0, 700, 120);

        // Lane (golf course)
        ctx.fillStyle = "#314027";
        ctx.fillRect(70, 40, 560, 30);
        ctx.strokeStyle = "#000";
        ctx.lineWidth = 4;
        ctx.strokeRect(70, 40, 560, 30);

        // Putty character inside canvas, aligned bottom with grass
        if (puttyLoaded) {
          const grassBottom = 40 + 30;
          const puttyHeight = 60; // Reduced to fit better in canvas
          const puttyY = grassBottom - puttyHeight + PUTTY_Y_OFFSET;
          const puttyX = PUTTY_X_OFFSET;
          ctx.drawImage(puttyImg, puttyX, puttyY, puttyHeight, puttyHeight);
        }

        // Hole
        ctx.fillStyle = "#000";
        ctx.beginPath();
        ctx.arc(620, 55, 6, 0, Math.PI * 2);
        ctx.fill();

        // Flag
        ctx.strokeStyle = "#000";
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.moveTo(620, 55);
        ctx.lineTo(620, 25);
        ctx.stroke();
        ctx.fillStyle = "#EC3C28";
        ctx.beginPath();
        ctx.moveTo(620, 25);
        ctx.lineTo(640, 30);
        ctx.lineTo(620, 35);
        ctx.fill();

        // Ball
        let ballDist = distance;
        if (state === "shooting" && ballAnimStart > 0) {
          const elapsed = performance.now() - ballAnimStart;
          const progress = Math.min(elapsed / 1000, 1);
          const eased = 1 - Math.pow(1 - progress, 3);
          ballDist = ballStart + (ballTarget - ballStart) * eased;
        }

        // Map distance [0..target] to lane X range [laneStartX..holeCenterX]
        const laneStartX = 70;
        const holeCenterX = 620; // matches hole draw position
        const mappingWidth = holeCenterX - laneStartX; // 550
        const ballX = laneStartX + (ballDist / target) * mappingWidth;
        ctx.fillStyle = "#fff";
        ctx.beginPath();
        ctx.arc(ballX, 55, 6, 0, Math.PI * 2);
        ctx.fill();
        ctx.strokeStyle = "#ccc";
        ctx.lineWidth = 1;
        ctx.stroke();

        // Power meter + button below the grass (show during aiming and email preview)
        if (state === "aiming" || state === "email") {
          const meterX = 320; // shifted right to make room for button
          const meterY = 90; // moved down with grass
          const meterW = 160; // 60% reduction from 400
          const meterH = 20;

          // Background & border
          ctx.fillStyle = "#f0f0f0";
          ctx.fillRect(meterX, meterY, meterW, meterH);
          ctx.strokeStyle = "#333";
          ctx.lineWidth = 2;
          ctx.strokeRect(meterX, meterY, meterW, meterH);

          // Static gradient fill from left (low) to right (high)
          const grad = ctx.createLinearGradient(meterX, meterY, meterX + meterW, meterY);
          grad.addColorStop(0, "#ffffff");
          grad.addColorStop(1, "#ec3c28");
          ctx.fillStyle = grad;
          ctx.fillRect(meterX, meterY, meterW, meterH);

          // Tick
          ctx.strokeStyle = "#000";
          ctx.lineWidth = 4;
          ctx.beginPath();
          const tickX = meterX + (powerTick / meterW) * meterW;
          ctx.moveTo(tickX, meterY);
          ctx.lineTo(tickX, meterY + meterH);
          ctx.stroke();

          // Current power number to the right of the bar
          ctx.fillStyle = "#02210a";
          ctx.font = "bold 16px Arial";
          ctx.textAlign = "left";
          ctx.textBaseline = "middle";
          ctx.fillText(String(power), meterX + meterW + 10, meterY + meterH / 2);

          // Canvas PUTT button to the left of the bar
          const btnW = 90,
            btnH = 24,
            btnX = meterX - (btnW + 15),
            btnY = meterY - 2;

          const preview = state === "email";
          // Active (clickable) button
          puttBtnRect = { x: btnX, y: btnY, w: btnW, h: btnH };
          ctx.fillStyle = preview ? "#bdbdbd" : "#ec3c28";
          ctx.fillRect(btnX, btnY, btnW, btnH);
          ctx.strokeStyle = preview ? "#9e9e9e" : "#a12a1a";
          ctx.lineWidth = 2;
          ctx.strokeRect(btnX, btnY, btnW, btnH);
          ctx.fillStyle = preview ? "#eeeeee" : "#fff";
          ctx.font = "bold 14px Arial";
          ctx.textAlign = "center";
          ctx.textBaseline = "middle";
          ctx.fillText("PUTT!", btnX + btnW / 2, btnY + btnH / 2);
        }
      }

      // Initial draw
      draw();
      // Show preview of the game and start aiming animation while in email state
      showGame(true);
      showAimBanner(false);
      startAiming();
    </script>
  </body>
</html>
